'From MIT Squeak 0.9.4 (June 1, 2003) [No updates present.] on 1 August 2018 at 8:02:36 pm'!Object subclass: #ScratchServer	instanceVariableNames: 'stage userName serverSocket incomingUDPSocket peerSockets peerNames sensors lastSentValues incomingBroadcasts outgoingBroadcasts in broadcastCache '	classVariableNames: 'JoinAddress '	poolDictionaries: ''	category: 'Scratch-Networking'!!DialogBoxMorph methodsFor: 'event handling' stamp: 'EiichiroIto 8/1/2018 19:19'!handlesMouseDown: evt	^ (evt cursorPoint y between: self top and: self top + 32) not! !!DialogBoxMorph methodsFor: 'event handling' stamp: 'EiichiroIto 8/1/2018 19:19'!mouseDown: evt 	! !!PaintFrame class methodsFor: 'kodo' stamp: 'EiichiroIto 8/1/2018 19:19'!resetClassVariables	"PaintFrame resetClassVariables."	ColorPicker := SquareColorPicker := nil! !!ScratchFrameMorph methodsFor: 'intialization' stamp: 'EiichiroIto 8/1/2018 19:19'!createMenuPanel	"Create and add a panel containing the menus and close button."	| menuSpecs m |	"create panel"	menuPanel _ AlignmentMorph new		color: Color transparent;		centering: #center;		inset: 0;		height: 0.	"will grow as needed"	self addShortcutButtonsTo: menuPanel.	"menuSpecs defines the menus"	menuSpecs _ #(		"name			selector"		(File			fileMenu:)		(Edit			editMenu:)		(Share			shareMenu:)		(Help			helpMenu:)	).	menuSpecs do: [:spec |		m _ ScratchMenuTitleMorph new			contents: (spec at: 1) localized;			target: self selector: (spec at: 2).		menuPanel addMorphBack: m.		#helpMenu: = (spec at: 2) ifFalse: [			menuPanel addMorphBack: (Morph new color: Color transparent; extent: 12@5)]].	topPane addMorph: menuPanel.! !!ScratchFrameMorph methodsFor: 'menu/button actions' stamp: 'EiichiroIto 8/1/2018 19:19'!aboutScratch	| dialogBox |	dialogBox _ DialogBoxMorph new		title: 'About kodo';		withButtonsForYes: false no: false okay: true cancel: false.	dialogBox		message: 'kodoCopyright © 2018 Eiichiro Ito (ghc02331@nifty.com)All rights reserved.Based on Scratch from the MIT Media Lab, v', Version, 'Copyright © 2009 Massachusetts Institute of Technology.All rights reserved.'		font: (ScratchFrameMorph getFont: #AboutScratch).	dialogBox getUserResponse.! !!ScratchFrameMorph methodsFor: 'menu/button actions' stamp: 'EiichiroIto 8/1/2018 19:19'!addServerCommandsTo: menu	"Add Scratch server commands to the given menu."	| disable endCmd |	disable _ false.  "make this true to disable this feature"	disable ifTrue: [^ self].	menu addLine.	(workPane scratchServer notNil and:	 [workPane scratchServer sessionInProgress])		ifTrue: [			menu add: 'Show IP Address' action: #showNetworkAddress.			endCmd _ workPane scratchServer isHosting				ifTrue: ['Stop Hosting Mesh']				ifFalse: ['Leave Mesh'].			menu add: endCmd action: #exitScratchSession]		ifFalse: [			menu add: 'Host Mesh' action: #startHostingScratchSession.			menu add: 'Join Mesh' action: #joinScratchSession].! !!ScratchFrameMorph methodsFor: 'menu/button actions' stamp: 'EiichiroIto 8/1/2018 19:19'!joinScratchSession	"Join another Scratch user or a Scratch-compatible remote application."	| server addrString ok |	server _ ScratchServer new.	server stage: workPane.	workPane scratchServer: server.	addrString _ StringDialog askWithCancel: 'IP address:' initialAnswer: ScratchServer joinAddress.	addrString size = 0 ifTrue: [^ self].	ScratchServer joinAddress: addrString.	ok _ workPane scratchServer joinSessionAt: addrString.	ok ifFalse: [DialogBoxMorph warn: 'Could not connect to ', addrString].! !!ScratchFrameMorph methodsFor: 'menu/button actions' stamp: 'EiichiroIto 8/1/2018 19:19'!newScratchProject	"Make a new, blank Scratch project."	| response newProject sprite |	self closeMediaEditorsAndDialogs ifFalse: [^ self].	self stopAll.	(justSaved or: [self projectIsEmpty]) ifFalse: [		"ask the user if they want to save the current project"		response _ DialogBoxMorph askWithCancel: 'Save the current project?'.		response = #cancelled ifTrue: [^ self].		response ifTrue: [self saveScratchProjectNoDialog.			justSaved ifFalse: [^ self]]].	projectDirectory _ ScratchFileChooserDialog getDefaultFolderForType: #project.	projectName _ ''.	projectInfo _ Dictionary new.	newProject _ ScratchStageMorph new.	"sprite _ ScratchFrameMorph defaultSprite fullCopy.	sprite position: (241@181) - sprite extent.	newProject addMorph: sprite."	self installNewProject: newProject.	self initializeWatcherPositions.	justSaved _ true.	"self enterNormalMode."! !!ScratchFrameMorph methodsFor: 'menu/button actions' stamp: 'EiichiroIto 8/1/2018 19:19'!shareMenu: aMenuTitleMorph 	| menu |	menu _ CustomMenu new.	self addServerCommandsTo: menu.	menu localize.	menu invokeOn: self at: aMenuTitleMorph bottomLeft + (0 @ 10)! !!ScratchLibraryMorph methodsFor: 'initialization' stamp: 'EiichiroIto 8/1/2018 19:19'!buildPanes	"Build my scroll pane."	| bin |	stagePane _ Morph new		color: Color transparent;		position: self position + (7@0).	bin _ ScratchSpriteLibraryMorph new		color: Color transparent;		borderWidth: 0.	scrollPane _ ScrollFrameMorph2 new		color: Color transparent;		contents: bin;		showHorizontalScrollbar: false.	spritePane _ Morph new		color: ScratchFrameMorph libraryColor;		position: self position.	spriteLabel _ self buildSpriteLabel.	buttonPane _ self makeNewSpriteButtons: (self ownerThatIsA: ScratchFrameMorph).	self addMorph: spritePane.	self addMorph: spriteLabel.	self addMorph: buttonPane.	self addMorph: scrollPane.	self addMorph: stagePane.! !!ScratchLibraryMorph methodsFor: 'initialization' stamp: 'EiichiroIto 8/1/2018 19:19'!buildSpriteLabel	^ StringMorph new		font: (ScratchFrameMorph getFont: #Tab);		color: ScratchFrameMorph textColor;		contents: 'New sprite:' localized! !!ScratchLibraryMorph methodsFor: 'drawing' stamp: 'EiichiroIto 8/1/2018 19:19'!drawBackgroundOn: aCanvas	"Draw my background."	| r |	"color isTransparent ifTrue: [^ self]."	color _ ScratchFrameMorph libraryColor.	aCanvas fillRectangle: (myBox insetBy: 7) color: color.	r _ ((stagePane right + 3) @ (myBox top + topSectionHeight + 12)) extent: (1 @ (myBox height - topSectionHeight - 30)).	aCanvas fillRectangle: r color: (Color gray: 0.3).	r _ (r origin + (1@0)) extent: (1 @ r height).	aCanvas fillRectangle: r color: Color veryLightGray.! !!ScratchListMorph methodsFor: 'initialization' stamp: 'EiichiroIto 8/1/2018 19:19'!initialize	super initialize.	self		color: ScratchFrameMorph listColor;		borderWidth: 2;		borderColor: self normalBorderColor;		useRoundedCorners.	cellMorphs _ OrderedCollection new: 1000.	numberMorphs _ #().	listLayoutNeeded _ true.	focusIndex _ 0.	lastActivityError _ false.	highlightActive _ false.	self addTitleAndControls.	self addScrollPane.	self extent: 65@115.! !!ScratchScriptsMorph methodsFor: 'drawing' stamp: 'EiichiroIto 8/1/2018 19:19'!drawOn: aCanvas	"Fill with my texture patch. Fill with a solid color if there is no texture in the current skin dictionary."	| patchF clipC y x |	self isScreenshooting ifTrue: [		aCanvas fillRectangle: self bounds color: Color transparent.		^ self].	aCanvas fillRectangle: self bounds color: color.		^ self.	"patchF _ ScratchFrameMorph skinAt: #scriptsPaneTexture ifAbsent: [		aCanvas fillRectangle: self bounds color: color.		^ self].	clipC _ aCanvas copyClipRect: self bounds.	y _ self top.	[y <= self bottom] whileTrue: [		x _ self left.		[x <= self right] whileTrue: [			clipC paintImage: patchF at: x@y.			x _ x + patchF width].		y _ y + patchF height]."! !!ScratchServer class methodsFor: 'kodo' stamp: 'EiichiroIto 6/23/2017 18:56'!joinAddress	^ JoinAddress ifNil: ['']! !!ScratchServer class methodsFor: 'kodo' stamp: 'EiichiroIto 6/23/2017 18:56'!joinAddress: aString	JoinAddress := aString! !!ScriptableScratchMorph methodsFor: 'blocks' stamp: 'EiichiroIto 8/1/2018 19:19'!viewerPageForMotion	"Answer a morph containing mtion blocks for the given category for use in the given ScratchViewer."	| bin isStage addMotorBlocks s font x y m |	bin _ ScratchBlockPaletteMorph new.	(self isKindOf: ScratchStageMorph)		ifTrue: [			isStage _ true.			addMotorBlocks _ self showMotorBlocks]		ifFalse: [			isStage _ false.			s _ self ownerThatIsA: ScratchStageMorph.			addMotorBlocks _ s notNil and: [s showMotorBlocks]].	(isStage & addMotorBlocks not) ifTrue: [		font _ (ScratchFrameMorph getFont: #ViewerPage).		x _ 20.		y _ 12.		m _ StringMorph contents: 'Stage selected:' localized font: font.		bin addMorph: (m color: ScratchFrameMorph textColor; position: x@y).		m _ StringMorph contents: 'No motion blocks' localized font: font.		bin addMorph: (m color: ScratchFrameMorph textColor; position: x@(y + 17)).		^ bin].	x _ 12.	y _ 10.	(self blocksFor: 'motion') do: [:blockOrSym |		(blockOrSym = #-) | (blockOrSym = #~)			ifTrue: [				(blockOrSym = #-) ifTrue: [y _ y + 15].  "insert a full space"				(blockOrSym = #~) ifTrue: [y _ y + 5]]  "insert a half space"			ifFalse: [				y _ self createBlock: blockOrSym atPosition: x@y onPage: bin]].	addMotorBlocks ifFalse: [^ bin].	isStage ifFalse: [		y _ y + 7.		bin addMorph: ((ImageMorph new form: (ScratchFrameMorph skinAt: #connector)) position: x@y).		y _ y + 20].	(self blocksFor: 'motor') do: [:blockOrSym |		(blockOrSym = #-) | (blockOrSym = #~)			ifTrue: [				(blockOrSym = #-) ifTrue: [y _ y + 15].  "insert a full space"				(blockOrSym = #~) ifTrue: [y _ y + 5]]  "insert a half space"			ifFalse: [				y _ self createBlock: blockOrSym atPosition: x@y onPage: bin]].	^ bin! !!ScratchStageMorph methodsFor: 'drawing' stamp: 'EiichiroIto 8/1/2018 19:19'!fullDrawOn: aCanvas	"Calls super fullDrawOn and then draws the frame shadow"	| shadowOrigin topShadowExtent leftShadowExtent alphas |	(self isQuarterSize and: [self isInWorld]) ifTrue: [		^ self drawQuarterSizeOn: aCanvas].	super fullDrawOn: aCanvas.	"don't draw shadows if owner is not a ScratchFrameMorph"	(owner isKindOf: ScratchFrameMorph) ifFalse: [^ self].	true ifTrue: [^ self].	"shadow constants"	shadowOrigin _ self topLeft + aCanvas origin.	topShadowExtent _ self width@1.	leftShadowExtent _ 1@self height.	"shadow alpha values"	alphas _ FloatArray		with: 0.51		with: 0.26		with: 0.07.	"top/horizontal shadow"	1 to: 3 do: [:i |		aCanvas grafPort			fill: (shadowOrigin + (0@(i-1)) extent: topShadowExtent)			fillColor: (Color black alpha: (alphas at: i))			rule: Form blend].	"left/vertical shadow"	1 to: 3 do: [:i |		aCanvas grafPort			fill: (shadowOrigin + ((i-1)@0) extent: leftShadowExtent)			fillColor: (Color black alpha: (alphas at: i))			rule: Form blend].	"corner shadow fix"	aCanvas grafPort		fill: (shadowOrigin extent: (1@1))		fillColor: (Color white alpha: 0.32)		rule: Form blend.	aCanvas grafPort		fill: (shadowOrigin +(0@1) extent: (1@1))		fillColor: (Color white alpha: 0.19)		rule: Form blend.	aCanvas grafPort		fill: (shadowOrigin + (1@0) extent: (1@1))		fillColor: (Color white alpha: 0.19)		rule: Form blend.	aCanvas grafPort		fill: (shadowOrigin +(0@2) extent: (1@1))		fillColor: (Color white alpha: 0.05)		rule: Form blend.	aCanvas grafPort		fill: (shadowOrigin + (2@0) extent: (1@1))		fillColor: (Color white alpha: 0.05)		rule: Form blend.! !!StringDialog methodsFor: 'initialization' stamp: 'EiichiroIto 8/1/2018 19:19'!initialize	"Similar to my superclass, but with a string field for the user's response."	super initialize.	self title: '?'.	"create and position typeinMorph"	mainColumn		addMorph: (Morph new extent: (5@6); color: Color transparent);		addMorph: (typeinMorph _ StringFieldMorph			new client: self;			borderWidth: 2;			color: ScratchFrameMorph fieldColor);		addMorph: (Morph new extent: (5@6); color: Color transparent).	typeinMorph		font: (ScratchFrameMorph getFont: #StringDialogTypeIn);		width: 250.	tabFields add: typeinMorph.! !!StringFieldMorph methodsFor: 'initialization' stamp: 'EiichiroIto 8/1/2018 19:19'!initialize	super initialize.	stringMorph _ StringMorph new		contents: UTF32 new font: (StrikeFont fontName: 'Verdana' size: 12);		forceUnicodeRendering: true.	self addMorph: stringMorph.	color _ ScratchFrameMorph fieldColor.	self textColor: ScratchFrameMorph dialogBoxTextColor.	doResizing _ false.	isNumeric _ false.	isEditable _ true.	isKeyboardFocus _ false.	acceptWhenFocusLost _ false.	self keyboardFocusChange: false.	selectionColor _ ScratchFrameMorph textSelectionColor.	selectionStart _ selectionEnd _ 0.	self recordUndoState.	self rightJustify: ScratchTranslator isRTL.	self borderInset; useNoFrame.	self width: 100.! !!UpdatingStringFieldMorph methodsFor: 'initialization' stamp: 'EiichiroIto 8/1/2018 19:19'!initialize	super initialize.	stringMorph color: ScratchFrameMorph textColor.	self useTypeinFrame.	self font: (StrikeFont fontName: 'Verdana' size: 12).! !!WatcherMorph methodsFor: 'initialization' stamp: 'EiichiroIto 8/1/2018 19:19'!initialize	super initialize.	titleMorph _ StringMorph contents: '???'.	titleMorph font: (ScratchFrameMorph getFont: #Watcher).	readout _ readoutFrame _ scratchSlider _ nil.	lastTargetName _ nil.	isSpriteSpecific _ true.	isLarge _ false.	sliderMin _ 0.	sliderMax _ 100.	watcher _ AlignmentMorph new		color: Color transparent;		borderWidth: 0;		inset: 0;		orientation: #horizontal;		hResizing: #shrinkWrap;		vResizing: #shrinkWrap;		centering: #center.	self 		color: ScratchFrameMorph watcherColor;		borderWidth: 1;		borderColor: ScratchFrameMorph watcherBorderColor;		orientation: #vertical;		centering: #center;		inset: 2;		hResizing: #shrinkWrap;		vResizing: #shrinkWrap;		buildReadout;		useRoundedCorners;		addMorphBack: watcher;		addMorphBack: (Morph new color: Color transparent; extent: 5@1).! !!WatcherMorph methodsFor: 'right button menu' stamp: 'EiichiroIto 8/1/2018 19:19'!showSmallReadout	self hideSlider.	isLarge _ false.	readout font: (ScratchFrameMorph getFont: #Watcher).	readoutFrame		borderColor: Color white;		fixLayout.	self		inset: 2;		color: ScratchFrameMorph watcherColor;		borderColor: ScratchFrameMorph watcherBorderColor;		cornerStyle: #rounded.	self layoutForViewer.! !!PaintFrame class reorganize!('instance creation' clearColorPickers new)('kodo' resetClassVariables)!