'From MIT Squeak 0.9.4 (June 1, 2003) [No updates present.] on 27 July 2018 at 7:04:40 am'!Object subclass: #ScratchServer	instanceVariableNames: 'stage userName serverSocket incomingUDPSocket peerSockets peerNames sensors lastSentValues incomingBroadcasts outgoingBroadcasts in broadcastCache '	classVariableNames: 'JoinAddress '	poolDictionaries: ''	category: 'Scratch-Networking'!!DialogBoxMorph methodsFor: 'event handling' stamp: 'EiichiroIto 8/27/2018 07:11'!handlesMouseDown: evt	^ (evt cursorPoint y between: self top and: self top + 32) not! !!DialogBoxMorph methodsFor: 'event handling' stamp: 'EiichiroIto 8/27/2018 07:11'!mouseDown: evt 	! !!LibraryItemMorph methodsFor: 'accessing' stamp: 'EiichiroIto 8/27/2018 07:11'!highlight: aBoolean	| labelColor |	isSelected = aBoolean ifTrue: [^ self].	isSelected _ aBoolean.	isSelected		ifTrue: [			rolloverOn _ false.			highlightForm extent: self extent.			currentForm _ highlightForm.			self addMorphBack: (currentForm position: (self position + (0@0))).			labelColor _ ScratchFrameMorph textColor]		ifFalse: [			currentForm ifNotNil: [				currentForm delete.				currentForm _ nil].			labelColor _ Color gray: 0.8].	nameMorph color: labelColor.	"scriptCountMorph color: labelColor darker."	self changed.! !!PaintFrame class methodsFor: 'kodo' stamp: 'EiichiroIto 8/27/2018 07:11'!resetClassVariables	"PaintFrame resetClassVariables."	ColorPicker := SquareColorPicker := nil! !!ScratchFileChooserDialog methodsFor: 'initialization' stamp: 'EiichiroIto 8/27/2018 07:11'!createScratchFileChooserFor: aScratchFrameMorph saving: savingFlag	"Create a Scratch file chooser dialog box with a project thumbnail and info box."	| labelFont contentsFont commentFont thumbnailHolder |	scratchFrame _ aScratchFrameMorph.	readingScratchFile _ savingFlag not.	list _ ScratchFilePicker new extensions: #(scratch sb).	self removeAllMorphs.	bottomSpacer delete.	bottomSpacer _ nil.	mainColumn addMorphBack: list.	savingFlag ifFalse: [		self title: 'Open Project'.		list scratchInfoClient: self].	labelFont _ (ScratchFrameMorph getFont: #FileChooserLabel).	contentsFont _ (ScratchFrameMorph getFont: #FileChooserContents).	commentFont _ (ScratchFrameMorph getFont: #FileChooserComment).	savingFlag ifTrue: [		self title: 'Save Project'.		newFileTitle _ StringMorph contents: ('New Filename:' localized, ' ') font: labelFont.		newFileTitle color: (Color gray: 0.3).		newFileName _ StringFieldMorph new			contents: scratchFrame projectName;			client: self;			font: contentsFont;			color: ScratchFrameMorph fieldColor;			width: 180.		tabFields add: newFileName.		newTitleBin			addMorphBack: newFileTitle;			addMorphBack: (Morph new extent: (5@5); color: Color transparent);			addMorphBack: newFileName;			addMorphBack: (AlignmentMorph newSpacer: Color transparent).		ScratchTranslator isRTL			ifTrue: [newTitleBin submorphs reversed do: [:m |				m delete.				newTitleBin addMorphBack: m]]].	mainColumn		addMorphBack: (Morph new extent: (5@9); color: Color transparent);		addMorphBack: newTitleBin.	thumbnailHolder _ AlignmentMorph newColumn		centering: #center;		color: Color transparent.	thumbnailFrameMorph _ ImageFrameMorph new		initFromForm: (ScratchFrameMorph skinAt: #dialogThumbnailFrame).	thumbnailFrameMorph extent: (170@130).	thumbnailHolder addMorph: thumbnailFrameMorph.	fileInfoColumn		addMorphBack: thumbnailHolder;		addMorphBack: (Morph new extent: (5@6); color: Color transparent). "spacer"	thumbnailMorph _ ImageMorph new form: (Form extent: 160@120 depth: 1).	thumbnailFrameMorph addMorphFront: (thumbnailMorph position: ((thumbnailFrameMorph position) + (5@5))).	authorLabelMorph _ StringMorph contents: 'Project author:' localized font: labelFont.	authorLabelMorph color: (Color gray: 0.3).	fileInfoColumn addMorphBack: authorLabelMorph.	savingFlag		ifTrue: [authorMorph _ StringFieldMorph new			useStringFieldFrame;			contents: '';			font: contentsFont.			tabFields add: authorMorph]		ifFalse: [fileInfoColumn addMorphBack: (Morph new extent: (5@6); color: Color transparent). "spacer"			authorMorph _ StringFieldMorph new				color: Color transparent;				borderWidth: 0;				contents: '';				isEditable: false;				font: contentsFont].	fileInfoColumn		addMorphBack: authorMorph;		addMorphBack: (Morph new extent: (5@6); color: Color transparent). "spacer"	commentLabelMorph _ StringMorph contents: 'About this project:' localized font: labelFont.	commentLabelMorph color: authorLabelMorph color.	fileInfoColumn addMorphBack: commentLabelMorph.	commentMorph _ ScrollingStringMorph new		borderWidth: 0;		contents: '';		font: commentFont;		extent: (210@110).	savingFlag		ifTrue: [commentMorph backForm: (ScratchFrameMorph skinAt: #stringFieldFrame).			tabFields add: commentMorph]		ifFalse: [commentMorph isEditable: false].	fileInfoColumn addMorphBack: commentMorph.	fileInfoColumn addMorphBack: buttonRow.	self		addMorphBack: shortcutColumn;		addMorphBack: mainColumn;		addMorphBack: fileInfoColumn.	savingFlag ifTrue: [		self scratchInfo: scratchFrame projectInfo.		thumbnailMorph form: scratchFrame workPane thumbnailForm.		"default author field to login name if known; else author"		(aScratchFrameMorph loginName size > 0)			ifTrue: [authorMorph contents: aScratchFrameMorph loginName]			ifFalse: [authorMorph contents: aScratchFrameMorph author]].! !!ScratchFilePickerEntry methodsFor: 'accessing' stamp: 'EiichiroIto 8/27/2018 07:11'!highlight: aBoolean	"Show or hide my highlight."	aBoolean ifFalse: [		highlit _ false.		self color: owner color.		nameMorph font: (ScratchFrameMorph getFont: #FilePickerEntry); color: Color black.		borderWidth _ 0.		^ self].	highlit _ true.	"self color: owner color darker darker darker.	borderWidth _ 2.	borderColor _ (Color r: (96/255) g: (136/255) b: (182/255))."	self color: ScratchFrameMorph folderHighlightColor.	nameMorph font: (ScratchFrameMorph getFont: #FilePickerEntryHighlighted); color: Color white.! !!ScratchFilePickerImageEntry methodsFor: 'accessing' stamp: 'EiichiroIto 8/27/2018 07:11'!highlight: aBoolean	"Show or hide my highlight."	aBoolean ifFalse: [		self color: owner color.		nameMorph font: (ScratchFrameMorph getFont: #FilePickerEntry); color: Color black.		highlit _ false.		borderWidth _ 0.		nameMorph left: self left + ((self width - nameMorph width) // 2).		^ self].	"self color: owner color darker darker darker.	borderWidth _ 2.	borderColor _ (Color r: (96/255) g: (136/255) b: (182/255))."	self color: ScratchFrameMorph folderHighlightColor.	nameMorph font: (ScratchFrameMorph getFont: #FilePickerEntryHighlighted); color: Color white.	nameMorph left: self left + ((self width - nameMorph width) // 2).	highlit _ true.! !!ScratchFrameMorph methodsFor: 'intialization' stamp: 'EiichiroIto 8/27/2018 07:11'!createMenuPanel	"Create and add a panel containing the menus and close button."	| menuSpecs m |	"create panel"	menuPanel _ AlignmentMorph new		color: Color transparent;		centering: #center;		inset: 0;		height: 0.	"will grow as needed"	self addShortcutButtonsTo: menuPanel.	"menuSpecs defines the menus"	menuSpecs _ #(		"name			selector"		(File			fileMenu:)		(Edit			editMenu:)		(Share			shareMenu:)		(Help			helpMenu:)	).	menuSpecs do: [:spec |		m _ ScratchMenuTitleMorph new			contents: (spec at: 1) localized;			target: self selector: (spec at: 2).		menuPanel addMorphBack: m.		#helpMenu: = (spec at: 2) ifFalse: [			menuPanel addMorphBack: (Morph new color: Color transparent; extent: 12@5)]].	topPane addMorph: menuPanel.! !!ScratchFrameMorph methodsFor: 'intialization' stamp: 'EiichiroIto 8/27/2018 07:11'!makeXYReadout	"Make and answer an x-y readout."	| normalFont boldFont panel spaceWidth labelX readoutX labelY readoutY |	normalFont _ (ScratchFrameMorph getFont: #XYReadout).	boldFont _ (ScratchFrameMorph getFont: #XYReadoutBold).	(ScratchTranslator renderScale ~= 1) ifTrue: [		"force fonts to be fixed size:"		normalFont _ StrikeFont			osFontName: normalFont name			size: normalFont pointSize / ScratchTranslator renderScale asFloat.		boldFont _ StrikeFont			osFontName: boldFont name			size: boldFont pointSize / ScratchTranslator renderScale asFloat].	panel _ Morph new color: ScratchFrameMorph readoutColor.	ScratchTranslator isRTL		ifTrue: [labelX _ StringMorph new font: normalFont; contents: ':x' asUTF8]		ifFalse: [labelX _ StringMorph new font: normalFont; contents: 'x:' asUTF8].	readoutX _ UpdatingStringMorph new		target: self; getSelector: #mouseX;		forceUnicodeRendering: true;		font: boldFont;		stepTime: 150;		growable: false.	readoutX width: (readoutX stringWidth: '-1000').	ScratchTranslator isRTL		ifTrue: [labelY _ labelX fullCopy contents: ':y' asUTF8]		ifFalse: [labelY _ labelX fullCopy contents: 'y:' asUTF8].	readoutY _ readoutX fullCopy getSelector: #mouseY.	spaceWidth _ ((readoutX stringWidth: ' ') * 0.8) asInteger.	ScratchTranslator isRTL		ifTrue: [readoutY rightJustify: true.			panel addMorph: (readoutY position: 0@0).			panel addMorph: (labelY position: ((readoutY topRight) + (spaceWidth@0))).]		ifFalse: [panel addMorph: (labelX position: 0@0).			panel addMorph: (readoutX position: ((labelX topRight) + (spaceWidth@0)))].	ScratchTranslator isRTL		ifTrue: [readoutX rightJustify: true.			panel addMorph: (readoutX position: (labelY right@labelY top) + (spaceWidth@0)).			panel addMorph: (labelX position: ((readoutX topRight) + (spaceWidth@0)))]		ifFalse: [panel addMorph: (labelY position: (labelX right + readoutX width + 8)@(labelX top)).			panel addMorph: (readoutY position: ((labelY topRight) + (spaceWidth@0)))].		ScratchTranslator isRTL		ifTrue: [panel extent: ((labelX right) max: (labelY right))@(labelY bottom)]		ifFalse: [panel extent: ((readoutX right) max: (readoutY right))@(labelY bottom)].	^ panel! !!ScratchFrameMorph methodsFor: 'menu/button actions' stamp: 'EiichiroIto 8/27/2018 07:11'!aboutScratch	| dialogBox |	dialogBox _ DialogBoxMorph new		title: 'About kodo';		withButtonsForYes: false no: false okay: true cancel: false.	dialogBox		message: 'kodoCopyright © 2018 Eiichiro Ito (ghc02331@nifty.com)All rights reserved.Based on Scratch from the MIT Media Lab, v', Version, 'Copyright © 2009 Massachusetts Institute of Technology.All rights reserved.'		font: (ScratchFrameMorph getFont: #AboutScratch).	dialogBox getUserResponse.! !!ScratchFrameMorph methodsFor: 'menu/button actions' stamp: 'EiichiroIto 8/27/2018 07:11'!addServerCommandsTo: menu	"Add Scratch server commands to the given menu."	| disable endCmd |	disable _ false.  "make this true to disable this feature"	disable ifTrue: [^ self].	menu addLine.	(workPane scratchServer notNil and:	 [workPane scratchServer sessionInProgress])		ifTrue: [			menu add: 'Show IP Address' action: #showNetworkAddress.			endCmd _ workPane scratchServer isHosting				ifTrue: ['Stop Hosting Mesh']				ifFalse: ['Leave Mesh'].			menu add: endCmd action: #exitScratchSession]		ifFalse: [			menu add: 'Host Mesh' action: #startHostingScratchSession.			menu add: 'Join Mesh' action: #joinScratchSession].! !!ScratchFrameMorph methodsFor: 'menu/button actions' stamp: 'EiichiroIto 8/27/2018 07:11'!helpMenu: aMenuTitleMorph	| menu |	menu _ CustomMenu new.	menu add: 'About kodo' action: #aboutScratch.	menu localize.	#(1) do: [:n |		menu labels at: n put:			((menu labels at: n) copyFrom: 1 to: (menu labels at: n) size - 1), ScratchTranslator ellipsesSuffix].	menu invokeOn: self at: aMenuTitleMorph bottomLeft + (0@10).! !!ScratchFrameMorph methodsFor: 'menu/button actions' stamp: 'EiichiroIto 8/27/2018 07:11'!joinScratchSession	"Join another Scratch user or a Scratch-compatible remote application."	| server addrString ok |	server _ ScratchServer new.	server stage: workPane.	workPane scratchServer: server.	addrString _ StringDialog askWithCancel: 'IP address:' initialAnswer: ScratchServer joinAddress.	addrString size = 0 ifTrue: [^ self].	ScratchServer joinAddress: addrString.	ok _ workPane scratchServer joinSessionAt: addrString.	ok ifFalse: [DialogBoxMorph warn: 'Could not connect to ', addrString].! !!ScratchFrameMorph methodsFor: 'menu/button actions' stamp: 'EiichiroIto 8/27/2018 07:11'!newScratchProject	"Make a new, blank Scratch project."	| response newProject sprite |	self closeMediaEditorsAndDialogs ifFalse: [^ self].	self stopAll.	(justSaved or: [self projectIsEmpty]) ifFalse: [		"ask the user if they want to save the current project"		response _ DialogBoxMorph askWithCancel: 'Save the current project?'.		response = #cancelled ifTrue: [^ self].		response ifTrue: [self saveScratchProjectNoDialog.			justSaved ifFalse: [^ self]]].	projectDirectory _ ScratchFileChooserDialog getDefaultFolderForType: #project.	projectName _ ''.	projectInfo _ Dictionary new.	newProject _ ScratchStageMorph new.	"sprite _ ScratchFrameMorph defaultSprite fullCopy.	sprite position: (241@181) - sprite extent.	newProject addMorph: sprite."	self installNewProject: newProject.	self initializeWatcherPositions.	justSaved _ true.	"self enterNormalMode."! !!ScratchFrameMorph methodsFor: 'menu/button actions' stamp: 'EiichiroIto 8/27/2018 07:11'!shareMenu: aMenuTitleMorph 	| menu |	menu _ CustomMenu new.	self addServerCommandsTo: menu.	menu localize.	menu invokeOn: self at: aMenuTitleMorph bottomLeft + (0 @ 10)! !!ScratchFrameMorph class methodsFor: 'scratch skin' stamp: 'EiichiroIto 8/27/2018 07:11'!readLogo	"ScratchFrameMorph readLogo."	| filename |	filename := (FileDirectory default directoryNamed: 'images') fullNameFor: 'sf13.png'.	self readSkinAt: #scratchLogo from: filename.! !!ScratchFrameMorph class methodsFor: 'scratch skin' stamp: 'EiichiroIto 8/20/2017 20:29'!readSkinAt: aSymbol from: aString    self skinAt: aSymbol put: (Form fromFileNamed: aString)! !!ScratchFrameMorph class methodsFor: 'scratch skin' stamp: 'EiichiroIto 7/27/2018 06:34'!replaceSkinFrom: aDirectory 	"self replaceSkinFrom: (FileDirectory default directoryNamed: 	'ScratchSkin') "	| img i |	aDirectory fileNames do: 		[:fn | 		Cursor read showWhile: [img := [Form fromFileNamed: (aDirectory fullNameFor: fn)]						ifError: []].		img			ifNotNil: 				[i := fn findLast: [:c | c = $.].				i = 0 ifFalse: [fn _ fn copyFrom: 1 to: i - 1].				(ScratchSkin includesKey: fn asSymbol)					ifFalse: [self error: fn , ' not found'].				ScratchSkin at: fn asSymbol put: img]].	img := ScratchSkin at: #scriptsPaneTexture ifAbsent: [].	(img notNil and: [img depth ~= 32])		ifTrue: [ScratchSkin at: #scriptsPaneTexture put: (img asFormOfDepth: 32)]! !!ScratchFrameMorph class methodsFor: 'scratch skin' stamp: 'EiichiroIto 8/27/2018 07:11'!skinAt: aSymbol put: aForm   ScratchSkin at: aSymbol put: aForm! !!ScratchFrameMorph class methodsFor: 'utilities' stamp: 'EiichiroIto 7/22/2018 12:08'!fieldColor	^ Color white! !!ScratchFrameMorph class methodsFor: 'utilities' stamp: 'EiichiroIto 7/26/2018 06:59'!folderHighlightColor	^ Color fromString: '#4c97ff'! !!ScratchFrameMorph class methodsFor: 'utilities' stamp: 'EiichiroIto 7/21/2018 19:14'!libraryColor	^ Color white! !!ScratchFrameMorph class methodsFor: 'utilities' stamp: 'EiichiroIto 7/22/2018 11:38'!listColor	^ Color white! !!ScratchFrameMorph class methodsFor: 'utilities' stamp: 'EiichiroIto 8/27/2018 07:11'!palettePaneColor	^ Color white! !!ScratchFrameMorph class methodsFor: 'utilities' stamp: 'EiichiroIto 7/22/2018 08:12'!readoutColor	^ Color white! !!ScratchFrameMorph class methodsFor: 'utilities' stamp: 'EiichiroIto 8/27/2018 07:11'!scriptsPaneColor	^ Color white! !!ScratchFrameMorph class methodsFor: 'utilities' stamp: 'EiichiroIto 7/21/2018 18:46'!textColor	^ Color black! !!ScratchFrameMorph class methodsFor: 'utilities' stamp: 'EiichiroIto 7/22/2018 12:19'!textSelectionColor	^ Color green! !!ScratchFrameMorph class methodsFor: 'utilities' stamp: 'EiichiroIto 7/22/2018 11:30'!watcherColor	^ Color white! !!ScratchLibraryMorph methodsFor: 'initialization' stamp: 'EiichiroIto 8/27/2018 07:11'!buildPanes	"Build my scroll pane."	| bin |	stagePane _ Morph new		color: Color transparent;		position: self position + (7@0).	bin _ ScratchSpriteLibraryMorph new		color: Color transparent;		borderWidth: 0.	scrollPane _ ScrollFrameMorph2 new		color: Color transparent;		contents: bin;		showHorizontalScrollbar: false.	spritePane _ Morph new		color: ScratchFrameMorph libraryColor;		position: self position.	spriteLabel _ self buildSpriteLabel.	buttonPane _ self makeNewSpriteButtons: (self ownerThatIsA: ScratchFrameMorph).	self addMorph: spritePane.	self addMorph: spriteLabel.	self addMorph: buttonPane.	self addMorph: scrollPane.	self addMorph: stagePane.! !!ScratchLibraryMorph methodsFor: 'initialization' stamp: 'EiichiroIto 8/27/2018 07:11'!buildSpriteLabel	^ StringMorph new		font: (ScratchFrameMorph getFont: #Tab);		color: ScratchFrameMorph textColor;		contents: 'New sprite:' localized! !!ScratchLibraryMorph methodsFor: 'drawing' stamp: 'EiichiroIto 8/27/2018 07:11'!drawBackgroundOn: aCanvas	"Draw my background."	| r |	"color isTransparent ifTrue: [^ self]."	color _ ScratchFrameMorph libraryColor.	aCanvas fillRectangle: (myBox insetBy: 7) color: color.	r _ ((stagePane right + 3) @ (myBox top + topSectionHeight + 12)) extent: (1 @ (myBox height - topSectionHeight - 30)).	aCanvas fillRectangle: r color: (Color gray: 0.3).	r _ (r origin + (1@0)) extent: (1 @ r height).	aCanvas fillRectangle: r color: Color veryLightGray.! !!ScratchListMorph methodsFor: 'initialization' stamp: 'EiichiroIto 8/27/2018 07:11'!initialize	super initialize.	self		color: ScratchFrameMorph listColor;		borderWidth: 2;		borderColor: self normalBorderColor;		useRoundedCorners.	cellMorphs _ OrderedCollection new: 1000.	numberMorphs _ #().	listLayoutNeeded _ true.	focusIndex _ 0.	lastActivityError _ false.	highlightActive _ false.	self addTitleAndControls.	self addScrollPane.	self extent: 65@115.! !!ScratchMenuTitleMorph methodsFor: 'accessing' stamp: 'EiichiroIto 8/27/2018 07:11'!highlightColor	^ Color gray: 0.3! !!ScratchMenuTitleMorph methodsFor: 'accessing' stamp: 'EiichiroIto 8/27/2018 07:11'!normalColor	^ Color white! !!ScratchScriptEditorMorph methodsFor: 'initialization' stamp: 'EiichiroIto 8/27/2018 07:11'!initialize	super initialize.	self		initFrontFromForm: (ScratchFrameMorph skinAt: #scriptPaneFrameTransparent2)		topSectionHeight: 90.	"self color: (Color r: (149/255) g: (154/255) b: (159/255))."	self color: Color white.	thumbnailMorph _ ScratchThumbnailMorph new.	self addMorph: (thumbnailMorph position: self position + (37@16)).	self addNameBox.	pageViewerMorph _ ScrollFrameMorph2 new		growthFraction: 0.1;		color: ScratchFrameMorph scriptsPaneColor.	self addMorph: (pageViewerMorph position: (self left @ (self top + topSectionHeight))).	rotationButtons _ #().	readoutMorphs _ #().	self target: nil.	thumbnailMorph extent: 50@50.	self extent: 300@400.	self createTabPane.! !!ScratchScriptsMorph methodsFor: 'drawing' stamp: 'EiichiroIto 8/27/2018 07:11'!drawOn: aCanvas	"Fill with my texture patch. Fill with a solid color if there is no texture in the current skin dictionary."	| patchF clipC y x |	self isScreenshooting ifTrue: [		aCanvas fillRectangle: self bounds color: Color transparent.		^ self].	aCanvas fillRectangle: self bounds color: color.		^ self.	"patchF _ ScratchFrameMorph skinAt: #scriptsPaneTexture ifAbsent: [		aCanvas fillRectangle: self bounds color: color.		^ self].	clipC _ aCanvas copyClipRect: self bounds.	y _ self top.	[y <= self bottom] whileTrue: [		x _ self left.		[x <= self right] whileTrue: [			clipC paintImage: patchF at: x@y.			x _ x + patchF width].		y _ y + patchF height]."! !!ScratchServer class methodsFor: 'as yet unclassified' stamp: 'EiichiroIto 6/23/2017 18:56'!joinAddress	^ JoinAddress ifNil: ['']! !!ScratchServer class methodsFor: 'as yet unclassified' stamp: 'EiichiroIto 6/23/2017 18:56'!joinAddress: aString	JoinAddress := aString! !!ScratchViewerMorph methodsFor: 'initialization' stamp: 'EiichiroIto 8/27/2018 07:11'!initialize	super initialize.	self		initFrontFromForm: (ScratchFrameMorph skinAt: #blocksPaletteFrameTransparent2)		topSectionHeight: 120.	self middleBarLeftMargin: 5 rightMargin: 0.	color _ Color white.	pageViewer _ ScrollFrameMorph2 new growthFraction: 0.1.	self addMorphBack: (pageViewer position: self position + (0@120)).	self target: nil.	self extent: 214@500.! !!ScratchViewerMorph methodsFor: 'initialization' stamp: 'EiichiroIto 8/27/2018 07:11'!rebuildCategorySelectors	| catList maxExtent buttons label offForm onForm overForm b pad leftColumnX rightColumnX x y |	catList _ #(		motion		control		looks		sensing		sound		operators		pen			variables).	"First, delete the old category buttons"	submorphs do: [:m | (m isKindOf: ResizableToggleButton2) ifTrue: [m delete]].	"Create new buttons, keeping track of the maximum extent."	maxExtent _ 75@0.	buttons _ catList collect: [:cat |		label _ (ScratchTranslator translationFor: cat asString) capitalized.		offForm _ (ScratchFrameMorph skinAt: cat).		onForm _ (ScratchFrameMorph skinAt: (cat, 'Pressed')).		overForm _ (ScratchFrameMorph skinAt: (cat, 'Over')).		ScratchTranslator isRTL			ifTrue:[				b _ ResizableToggleButton2 new					offForm:	(offForm flipBy: #horizontal centerAt: offForm center)					onForm:		(onForm flipBy: #horizontal centerAt: onForm center)					overForm:	(overForm flipBy: #horizontal centerAt: overForm center)]			ifFalse:[				b _ ResizableToggleButton2 new					offForm:	offForm					onForm:		onForm					overForm:	overForm].		b			label: label font: (ScratchFrameMorph getFont: #Category);			setLabelColor: ScratchFrameMorph textColor;			target: self;			actionSelector: #currentCategory:;			arguments: (Array with: cat);			toggleButtonMode: true;			toggleMode: false.		ScratchTranslator isRTL			ifTrue:[b rightJustifyInset: 10]			ifFalse:[b leftJustifyInset: 10].		maxExtent _ maxExtent max: (b extent + (3 @ -6)).		b].	"calculate catButtonsExtent"	pad _ 15. "padding on left, right, and betwen the button columns"	catButtonsExtent _ ((2 * maxExtent x) + (3 * pad)) @ (((catList size // 2) * (maxExtent y + 6)) + 25).	"place the buttons"	leftColumnX _ self left + 12 + pad.	rightColumnX _ leftColumnX + maxExtent x + pad.	x _ leftColumnX.	y _ self top + 17.	1 to: buttons size do: [:i |		b _ buttons at: i.		b extent: maxExtent.		self addMorph: (b position: x@y).		i even			ifTrue: [x _ leftColumnX. y _ y + b height + 6]			ifFalse: [x _ rightColumnX]].	self width: catButtonsExtent x.	pageViewer position: self position + (0@catButtonsExtent y).	topSectionHeight _ catButtonsExtent y - 4.! !!ScriptableScratchMorph methodsFor: 'blocks' stamp: 'EiichiroIto 8/27/2018 07:11'!viewerPageForMotion	"Answer a morph containing mtion blocks for the given category for use in the given ScratchViewer."	| bin isStage addMotorBlocks s font x y m |	bin _ ScratchBlockPaletteMorph new.	(self isKindOf: ScratchStageMorph)		ifTrue: [			isStage _ true.			addMotorBlocks _ self showMotorBlocks]		ifFalse: [			isStage _ false.			s _ self ownerThatIsA: ScratchStageMorph.			addMotorBlocks _ s notNil and: [s showMotorBlocks]].	(isStage & addMotorBlocks not) ifTrue: [		font _ (ScratchFrameMorph getFont: #ViewerPage).		x _ 20.		y _ 12.		m _ StringMorph contents: 'Stage selected:' localized font: font.		bin addMorph: (m color: ScratchFrameMorph textColor; position: x@y).		m _ StringMorph contents: 'No motion blocks' localized font: font.		bin addMorph: (m color: ScratchFrameMorph textColor; position: x@(y + 17)).		^ bin].	x _ 12.	y _ 10.	(self blocksFor: 'motion') do: [:blockOrSym |		(blockOrSym = #-) | (blockOrSym = #~)			ifTrue: [				(blockOrSym = #-) ifTrue: [y _ y + 15].  "insert a full space"				(blockOrSym = #~) ifTrue: [y _ y + 5]]  "insert a half space"			ifFalse: [				y _ self createBlock: blockOrSym atPosition: x@y onPage: bin]].	addMotorBlocks ifFalse: [^ bin].	isStage ifFalse: [		y _ y + 7.		bin addMorph: ((ImageMorph new form: (ScratchFrameMorph skinAt: #connector)) position: x@y).		y _ y + 20].	(self blocksFor: 'motor') do: [:blockOrSym |		(blockOrSym = #-) | (blockOrSym = #~)			ifTrue: [				(blockOrSym = #-) ifTrue: [y _ y + 15].  "insert a full space"				(blockOrSym = #~) ifTrue: [y _ y + 5]]  "insert a half space"			ifFalse: [				y _ self createBlock: blockOrSym atPosition: x@y onPage: bin]].	^ bin! !!ScratchStageMorph methodsFor: 'drawing' stamp: 'EiichiroIto 8/27/2018 07:11'!fullDrawOn: aCanvas	"Calls super fullDrawOn and then draws the frame shadow"	| shadowOrigin topShadowExtent leftShadowExtent alphas |	(self isQuarterSize and: [self isInWorld]) ifTrue: [		^ self drawQuarterSizeOn: aCanvas].	super fullDrawOn: aCanvas.	"don't draw shadows if owner is not a ScratchFrameMorph"	(owner isKindOf: ScratchFrameMorph) ifFalse: [^ self].	true ifTrue: [^ self].	"shadow constants"	shadowOrigin _ self topLeft + aCanvas origin.	topShadowExtent _ self width@1.	leftShadowExtent _ 1@self height.	"shadow alpha values"	alphas _ FloatArray		with: 0.51		with: 0.26		with: 0.07.	"top/horizontal shadow"	1 to: 3 do: [:i |		aCanvas grafPort			fill: (shadowOrigin + (0@(i-1)) extent: topShadowExtent)			fillColor: (Color black alpha: (alphas at: i))			rule: Form blend].	"left/vertical shadow"	1 to: 3 do: [:i |		aCanvas grafPort			fill: (shadowOrigin + ((i-1)@0) extent: leftShadowExtent)			fillColor: (Color black alpha: (alphas at: i))			rule: Form blend].	"corner shadow fix"	aCanvas grafPort		fill: (shadowOrigin extent: (1@1))		fillColor: (Color white alpha: 0.32)		rule: Form blend.	aCanvas grafPort		fill: (shadowOrigin +(0@1) extent: (1@1))		fillColor: (Color white alpha: 0.19)		rule: Form blend.	aCanvas grafPort		fill: (shadowOrigin + (1@0) extent: (1@1))		fillColor: (Color white alpha: 0.19)		rule: Form blend.	aCanvas grafPort		fill: (shadowOrigin +(0@2) extent: (1@1))		fillColor: (Color white alpha: 0.05)		rule: Form blend.	aCanvas grafPort		fill: (shadowOrigin + (2@0) extent: (1@1))		fillColor: (Color white alpha: 0.05)		rule: Form blend.! !!StringDialog methodsFor: 'initialization' stamp: 'EiichiroIto 8/27/2018 07:11'!initialize	"Similar to my superclass, but with a string field for the user's response."	super initialize.	self title: '?'.	"create and position typeinMorph"	mainColumn		addMorph: (Morph new extent: (5@6); color: Color transparent);		addMorph: (typeinMorph _ StringFieldMorph			new client: self;			borderWidth: 2;			color: ScratchFrameMorph fieldColor);		addMorph: (Morph new extent: (5@6); color: Color transparent).	typeinMorph		font: (ScratchFrameMorph getFont: #StringDialogTypeIn);		width: 250.	tabFields add: typeinMorph.! !!StringFieldMorph methodsFor: 'initialization' stamp: 'EiichiroIto 8/27/2018 07:11'!initialize	super initialize.	stringMorph _ StringMorph new		contents: UTF32 new font: (StrikeFont fontName: 'Verdana' size: 12);		forceUnicodeRendering: true.	self addMorph: stringMorph.	color _ ScratchFrameMorph fieldColor.	doResizing _ false.	isNumeric _ false.	isEditable _ true.	isKeyboardFocus _ false.	acceptWhenFocusLost _ false.	self keyboardFocusChange: false.	selectionColor _ ScratchFrameMorph textSelectionColor.	selectionStart _ selectionEnd _ 0.	self recordUndoState.	self rightJustify: ScratchTranslator isRTL.	self borderInset; useNoFrame.	self width: 100.! !!UpdatingStringFieldMorph methodsFor: 'initialization' stamp: 'EiichiroIto 8/27/2018 07:11'!initialize	super initialize.	stringMorph color: ScratchFrameMorph textColor.	self useTypeinFrame.	self font: (StrikeFont fontName: 'Verdana' size: 12).! !!WatcherMorph methodsFor: 'initialization' stamp: 'EiichiroIto 8/27/2018 07:11'!initialize	super initialize.	titleMorph _ StringMorph contents: '???'.	titleMorph font: (ScratchFrameMorph getFont: #Watcher).	readout _ readoutFrame _ scratchSlider _ nil.	lastTargetName _ nil.	isSpriteSpecific _ true.	isLarge _ false.	sliderMin _ 0.	sliderMax _ 100.	watcher _ AlignmentMorph new		color: Color transparent;		borderWidth: 0;		inset: 0;		orientation: #horizontal;		hResizing: #shrinkWrap;		vResizing: #shrinkWrap;		centering: #center.	self 		color: ScratchFrameMorph watcherColor;		borderWidth: 1;		borderColor: (Color black);		orientation: #vertical;		centering: #center;		inset: 2;		hResizing: #shrinkWrap;		vResizing: #shrinkWrap;		buildReadout;		useRoundedCorners;		addMorphBack: watcher;		addMorphBack: (Morph new color: Color transparent; extent: 5@1).! !!WatcherMorph methodsFor: 'right button menu' stamp: 'EiichiroIto 8/27/2018 07:11'!showSmallReadout	self hideSlider.	isLarge _ false.	readout font: (ScratchFrameMorph getFont: #Watcher).	readoutFrame		borderColor: Color white;		fixLayout.	self		inset: 2;		color: ScratchFrameMorph watcherColor;		borderColor: (Color r: (148/255) g: (145/255) b: (145/255));		cornerStyle: #rounded.	self layoutForViewer.! !!PaintFrame class reorganize!('instance creation' clearColorPickers new)('kodo' resetClassVariables)!ScratchFrameMorph replaceSkinFrom: (FileDirectory default directoryNamed: 'ScratchSkin').MediaItemMorph initialize.PaintFrame resetClassVariables.!